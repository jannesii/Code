{% extends 'base.html' %}

{% block title %}VPN/DNS ohitus{% endblock %}

{% block styles %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/flash.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/edit_user.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/novpn.css') }}">
{% endblock %}

{% block content %}
  {% include 'settings_flash.html' %}

  <div class="container">
    <div class="edit-card">
      <h2>VPN/DNS ohitus</h2>
      <p class="nv-hint">Muokkaa laitekohtaiset VPN- ja DNS-ohitukset. Tallennus päivittää tiedoston <code>~/.config/novpn/devices.conf</code>.</p>

      <form method="post" style="margin-bottom:16px;">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div class="form-row">
          <label for="new_name">Nimi</label>
          <input type="text" id="new_name" name="new_name" placeholder="Esim. PlayStation" required>
        </div>
        <div class="form-row">
          <label for="new_mac">MAC</label>
          <input type="text" id="new_mac" name="new_mac" placeholder="aa:bb:cc:dd:ee:ff" pattern="^([0-9A-Fa-f]{2}[:\-]){5}[0-9A-Fa-f]{2}$" required>
        </div>
        <div class="actions">
          <button type="submit" name="add_device" value="1" class="btn primary">Lisää laite</button>
        </div>
      </form>

      {% if not devices %}
        <p class="nv-hint">Asetustiedostossa ei ole laitteita.</p>
      {% else %}
        <form method="post">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

          <div class="nv-device-list">
            {% for d in devices %}
            <div class="nv-device-row">
              <div class="nv-device-info">
                <div class="nv-device-name">{{ d.name }}</div>
                <div class="nv-device-mac">{{ d.mac }}</div>
              </div>
              <div class="nv-device-toggles">
                <label class="checkbox">
                  <input type="checkbox" name="novpn_{{ d.mac }}" {% if d.novpn %}checked{% endif %}>
                  Ohita VPN
                </label>
                <label class="checkbox">
                  <input type="checkbox" name="nodns_{{ d.mac }}" {% if d.nodns %}checked{% endif %}>
                  Ohita DNS
                </label>
              </div>
            </div>
            {% endfor %}
          </div>

          <div class="actions">
            <a class="btn secondary" href="{{ url_for('web.get_settings_page') }}">Peruuta</a>
            <button type="submit" class="btn primary">Tallenna</button>
          </div>
        </form>
      {% endif %}
    </div>
  </div>
{% endblock %}

{% block scripts %}
  <script src="{{ url_for('static', filename='js/novpn.js') }}"></script>
{% endblock %}
